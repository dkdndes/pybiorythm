# JSON Data Format Reference

This document describes the JSON output format for biorhythm data generated by the `generate_timeseries_json()` method. This format is optimized for data analysis, visualization, and integration with pandas, matplotlib, and other Python data libraries.

## Quick Example

```python
from datetime import datetime
from biorythm import BiorhythmCalculator

calc = BiorhythmCalculator(days=7)
data = calc.generate_timeseries_json(datetime(1990, 5, 15))

print(data.keys())  # ['metadata', 'timeseries']
print(len(data['timeseries']))  # 7 days of data
```

## Complete Schema Structure

### Root Object

```json
{
  "metadata": {
    "birthdate": "1990-05-15",
    "chart_start_date": "2024-01-15",
    "chart_period_days": 30,
    "chart_orientation": "vertical",
    "generation_timestamp": "2024-01-15T10:30:00Z",
    "cycles": {
      "physical": {
        "period_days": 23,
        "description": "Physical cycle affecting strength, endurance, energy"
      },
      "emotional": {
        "period_days": 28,
        "description": "Emotional cycle affecting mood, creativity, sensitivity"
      },
      "intellectual": {
        "period_days": 33,
        "description": "Intellectual cycle affecting mental acuity, logic, reasoning"
      }
    },
    "cycle_repeats": {
      "physical_emotional": 644,
      "all_three_cycles": 21252
    }
  },
  "timeseries": [
    {
      "date": "2024-01-15",
      "day_number": 12345,
      "cycles": {
        "physical": 0.78,
        "emotional": -0.43,
        "intellectual": 0.21
      },
      "critical_days": []
    }
  ]
}
```

## Metadata Section

Contains chart configuration and cycle information.

### Fields

- **`birthdate`** (string): Birth date in ISO 8601 format (YYYY-MM-DD)
- **`chart_start_date`** (string): First date in timeseries data
- **`chart_period_days`** (integer): Number of days included in timeseries
- **`chart_orientation`** (string): Chart type ("vertical" or "horizontal")
- **`generation_timestamp`** (string): When data was generated (ISO 8601)
- **`cycles`** (object): Cycle definitions with periods and descriptions
- **`cycle_repeats`** (object): Information about when cycles repeat

### Cycle Information

Each cycle has:
- **`period_days`** (integer): Length of cycle in days
- **`description`** (string): Human-readable cycle description

### Cycle Repeat Patterns

- **`physical_emotional`**: 644 days (23 × 28 cycle coincidence)
- **`all_three_cycles`**: 21,252 days (23 × 28 × 33 = ~58.2 years)

## Timeseries Section

Array of daily biorhythm data points.

### Timeseries Entry

```json
{
  "date": "2024-01-15",
  "day_number": 12345,
  "cycles": {
    "physical": 0.78,
    "emotional": -0.43,
    "intellectual": 0.21
  },
  "critical_days": ["physical_positive"]
}
```

### Fields

- **`date`** (string): Date in ISO 8601 format (YYYY-MM-DD)
- **`day_number`** (integer): Days since birth (calculated as: target_date - birthdate)
- **`cycles`** (object): Cycle values for this date
- **`critical_days`** (array): List of critical events for this date

### Cycle Values

All cycle values are floats between -1.0 and +1.0:
- **+1.0**: Peak positive (maximum performance)
- **0.0**: Transition point (critical day)
- **-1.0**: Peak negative (minimum performance)

### Critical Day Types

When a cycle crosses zero, it's marked as a critical day:

- **`"physical_positive"`**: Physical cycle crossing from negative to positive
- **`"physical_negative"`**: Physical cycle crossing from positive to negative
- **`"emotional_positive"`**: Emotional cycle crossing from negative to positive
- **`"emotional_negative"`**: Emotional cycle crossing from positive to negative
- **`"intellectual_positive"`**: Intellectual cycle crossing from negative to positive
- **`"intellectual_negative"`**: Intellectual cycle crossing from positive to negative

## Data Analysis Examples

### Loading with Pandas

```python
import pandas as pd
from biorythm import BiorhythmCalculator

# Generate data
calc = BiorhythmCalculator(days=90)
data = calc.generate_timeseries_json(datetime(1990, 5, 15))

# Convert to DataFrame
df = pd.json_normalize(data['timeseries'])
df['date'] = pd.to_datetime(df['date'])
df.set_index('date', inplace=True)

# Access cycle columns
physical = df['cycles.physical']
emotional = df['cycles.emotional']
intellectual = df['cycles.intellectual']

print(df.head())
```

### Finding Critical Days

```python
# Find all critical days
critical_days_df = df[df['critical_days'].str.len() > 0]
print(f"Found {len(critical_days_df)} critical days")

# Find specific critical events
physical_peaks = df[df['critical_days'].str.contains('physical', na=False)]
print(f"Physical critical days: {len(physical_peaks)}")
```

### Statistical Analysis

```python
# Calculate cycle statistics
cycle_cols = ['cycles.physical', 'cycles.emotional', 'cycles.intellectual']
stats = df[cycle_cols].describe()
print(stats)

# Find correlations between cycles
correlations = df[cycle_cols].corr()
print(correlations)
```

### Visualization with Matplotlib

```python
import matplotlib.pyplot as plt

# Plot all cycles
fig, ax = plt.subplots(figsize=(12, 6))
ax.plot(df.index, df['cycles.physical'], label='Physical', linewidth=2)
ax.plot(df.index, df['cycles.emotional'], label='Emotional', linewidth=2)
ax.plot(df.index, df['cycles.intellectual'], label='Intellectual', linewidth=2)

# Mark critical days
critical_dates = df[df['critical_days'].str.len() > 0].index
ax.scatter(critical_dates, [0] * len(critical_dates), 
           color='red', marker='o', s=50, label='Critical Days')

ax.axhline(y=0, color='black', linestyle='--', alpha=0.3)
ax.set_xlabel('Date')
ax.set_ylabel('Cycle Value')
ax.set_title('Biorhythm Cycles Over Time')
ax.legend()
ax.grid(True, alpha=0.3)
plt.show()
```

## Converting to Other Formats

### Export to CSV

```python
import pandas as pd

# Flatten the nested JSON structure
df = pd.json_normalize(data['timeseries'])

# Export to CSV
df.to_csv('biorhythm_data.csv', index=False)

# Custom CSV with just cycles
cycles_df = df[['date', 'cycles.physical', 'cycles.emotional', 'cycles.intellectual']]
cycles_df.columns = ['date', 'physical', 'emotional', 'intellectual']
cycles_df.to_csv('biorhythm_cycles.csv', index=False)
```

### Store in SQLite Database

```python
import sqlite3
import json

# Store complete JSON
conn = sqlite3.connect('biorhythm.db')
conn.execute('''CREATE TABLE IF NOT EXISTS biorhythm_data 
                (id INTEGER PRIMARY KEY, birthdate TEXT, data TEXT)''')

conn.execute('INSERT INTO biorhythm_data (birthdate, data) VALUES (?, ?)',
             (data['metadata']['birthdate'], json.dumps(data)))
conn.commit()
conn.close()
```

## JSON Schema Validation

For programmatic validation, here's the JSON Schema:

```python
import jsonschema

schema = {
    "type": "object",
    "required": ["metadata", "timeseries"],
    "properties": {
        "metadata": {
            "type": "object",
            "required": ["birthdate", "chart_period_days", "cycles"],
            "properties": {
                "birthdate": {"type": "string", "format": "date"},
                "chart_period_days": {"type": "integer", "minimum": 1},
                "cycles": {"type": "object"}
            }
        },
        "timeseries": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["date", "day_number", "cycles"],
                "properties": {
                    "date": {"type": "string", "format": "date"},
                    "day_number": {"type": "integer", "minimum": 0},
                    "cycles": {
                        "type": "object",
                        "required": ["physical", "emotional", "intellectual"],
                        "properties": {
                            "physical": {"type": "number", "minimum": -1, "maximum": 1},
                            "emotional": {"type": "number", "minimum": -1, "maximum": 1},
                            "intellectual": {"type": "number", "minimum": -1, "maximum": 1}
                        }
                    }
                }
            }
        }
    }
}

# Validate your data
jsonschema.validate(data, schema)
```

## Performance and Size

### Typical Data Sizes

- **1 day**: ~150 bytes
- **30 days**: ~4.5 KB  
- **365 days**: ~55 KB
- **1000 days**: ~150 KB

### Memory Usage

```python
import sys
import json

# Check memory usage
data = calc.generate_timeseries_json(datetime(1990, 5, 15))
size_bytes = len(json.dumps(data).encode('utf-8'))
memory_usage = sys.getsizeof(data)

print(f"JSON size: {size_bytes:,} bytes")
print(f"Memory usage: {memory_usage:,} bytes")
```

## See Also

- **[Calculator API](calculator.md)** - Main API reference
- **[Data Analysis Examples](../../examples/time-series/)** - Jupyter notebooks with analysis
- **[Visualization Gallery](../../examples/notebooks/)** - Chart examples with multiple libraries
- **[Integration Guide](../guides/integration.md)** - Using with pandas, matplotlib, plotly